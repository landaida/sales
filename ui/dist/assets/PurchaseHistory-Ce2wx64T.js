import{r as l,j as t,f as y,G as g}from"./index-Drabqqll.js";const h=new g;function b(){const[x,u]=l.useState([]),[i,j]=l.useState(0),[d,a]=l.useState(!1),[n,c]=l.useState({});async function o(){if(!(d||i===null)){a(!0);try{const e=await h.purchaseHistory(i,5);e!=null&&e.ok&&(u(r=>[...r,...e.items]),j(e.next))}finally{a(!1)}}}l.useEffect(()=>{o()},[]);async function p(e){if(n[e]){const s={...n};delete s[e],c(s);return}const r=await h.purchaseDetails(e);c(s=>({...s,[e]:(r==null?void 0:r.items)||[]}))}return t.jsxs("section",{children:[t.jsx("h2",{children:"Historial de compras (últimas 5)"}),t.jsx("ul",{style:{listStyle:"none",padding:0},children:x.map((e,r)=>t.jsxs("li",{style:{border:"1px solid #ddd",borderRadius:6,padding:8,marginBottom:8},children:[t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("b",{children:new Date(e.date).toLocaleString()})," — ",e.supplier," — ",e.factura,"  ",t.jsxs("span",{style:{opacity:.7},children:["Total: ",y.format(e.totalGs||0)," Gs"]})]}),t.jsxs("div",{children:[e.fileUrl&&t.jsx("a",{href:e.fileUrl,target:"_blank",rel:"noreferrer",style:{marginRight:12},children:"PDF"}),t.jsx("button",{onClick:()=>p(e.factura),children:n[e.factura]?"Ocultar":"Ver detalles"})]})]}),n[e.factura]&&t.jsxs("table",{style:{marginTop:8,width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Cod"}),t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Color"}),t.jsx("th",{children:"Talla"}),t.jsx("th",{children:"Qty"}),t.jsx("th",{children:"Unit Gs"}),t.jsx("th",{children:"Total Gs"})]})}),t.jsx("tbody",{children:n[e.factura].map((s,f)=>t.jsxs("tr",{children:[t.jsx("td",{children:s.code}),t.jsx("td",{children:s.product}),t.jsx("td",{children:s.color}),t.jsx("td",{children:s.size}),t.jsx("td",{children:s.qty}),t.jsx("td",{style:{textAlign:"right"},children:Math.round(s.unitGs)}),t.jsx("td",{style:{textAlign:"right"},children:Math.round(s.totalGs)})]},f))})]})]},r))}),i!==null&&t.jsx("button",{disabled:d,onClick:o,children:d?"Cargando...":"Cargar más"})]})}export{b as default};

import{r,j as t,f as i}from"./index-Drabqqll.js";function y(){const[h,u]=r.useState([]),[a,j]=r.useState(0),[o,c]=r.useState(!1),[l,d]=r.useState({});async function x(){if(!(o||a===null)){c(!0);try{const e=await fetch(`/gsapi/exec?action=sales_history&cursor=${a}&limit=5`).then(n=>n.json());e!=null&&e.ok&&(u(n=>[...n,...e.items]),j(e.next))}finally{c(!1)}}}r.useEffect(()=>{x()},[]);async function f(e){if(l[e]){const s={...l};delete s[e],d(s);return}const n=await fetch(`/gsapi/exec?action=sale_details&ticket=${encodeURIComponent(e)}`).then(s=>s.json());d(s=>({...s,[e]:(n==null?void 0:n.items)||[]}))}return t.jsxs("section",{children:[t.jsx("h2",{children:"Historial de ventas (últimas 5)"}),t.jsx("ul",{style:{listStyle:"none",padding:0},children:h.map((e,n)=>t.jsxs("li",{style:{border:"1px solid #ddd",borderRadius:6,padding:8,marginBottom:8},children:[t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("b",{children:new Date(e.date).toLocaleString()})," — ",e.ticket," — ",e.cliente,"  ",t.jsxs("span",{style:{opacity:.8},children:["Total: ",i.format(e.total||0)," | Desc: ",i.format(e.descuento||0)," | Entrega: ",i.format(e.entrega||0)," | A plazo: ",i.format(e.aplazo||0)]})]}),t.jsx("button",{onClick:()=>f(e.ticket),children:l[e.ticket]?"Ocultar":"Ver detalles"})]}),l[e.ticket]&&t.jsxs("table",{style:{marginTop:8,width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cant"}),t.jsx("th",{children:"Unit"}),t.jsx("th",{children:"Total"}),t.jsx("th",{children:"Desc$"})]})}),t.jsx("tbody",{children:l[e.ticket].map((s,m)=>t.jsxs("tr",{children:[t.jsx("td",{children:s.producto}),t.jsx("td",{children:s.qty}),t.jsx("td",{style:{textAlign:"right"},children:i.format(s.unit||0)}),t.jsx("td",{style:{textAlign:"right"},children:i.format(s.total||0)}),t.jsx("td",{style:{textAlign:"right"},children:i.format(s.desc||0)})]},m))})]})]},n))}),a!==null&&t.jsx("button",{disabled:o,onClick:x,children:o?"Cargando...":"Cargar más"})]})}export{y as default};
